<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="icon" href="./images/avt2.jpg" type="image/x-icon" />
    <link rel="shortcut icon" href="./images/avt2.jpg" type="image/x-icon" />

    <meta property="og:type" content="website" />
    <meta property="og:title" content="VuKhu" />
    <meta property="og:description" content="Nghe Nh·∫°c B·∫±ng M≈©i" />

    <title>VuDinhKhu|Music</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <style>
        /* Reset v√† base styles */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 25%, #24243e 50%, #1a1a2e 75%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px;
            color: white;
            overflow-x: hidden;
            position: relative;
        }
        /* Hi·ªáu ·ª©ng Meteor Showers */
        
        .meteor {
            position: fixed;
            top: -10px;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(0, 255, 255, 0.7);
            animation: meteorFall linear forwards;
            z-index: -1;
        }
        
        @keyframes meteorFall {
            0% {
                transform: translateY(0) translateX(0) rotate(45deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) translateX(100vw) rotate(45deg);
                opacity: 0;
            }
        }
        /* Hi·ªáu ·ª©ng sao bƒÉng l·ªõn */
        
        .shooting-star {
            position: fixed;
            top: -50px;
            width: 3px;
            height: 100px;
            background: linear-gradient(transparent, #00ffff, transparent);
            box-shadow: 0 0 20px 3px rgba(0, 255, 255, 0.8);
            animation: shootingStar linear forwards;
            z-index: -1;
        }
        
        @keyframes shootingStar {
            0% {
                transform: translateY(0) translateX(0) rotate(-45deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) translateX(100vw) rotate(-45deg);
                opacity: 0;
            }
        }
        /* Hi·ªáu ·ª©ng twinkling stars */
        
        .star {
            position: fixed;
            background: white;
            border-radius: 50%;
            animation: twinkle infinite alternate;
            z-index: -1;
        }
        
        @keyframes twinkle {
            0% {
                opacity: 0.2;
            }
            100% {
                opacity: 1;
            }
        }
        
        .wrapper {
            width: 95%;
            max-width: 300px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            margin: 10px auto;
            position: relative;
            z-index: 1;
        }
        
        .top-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .avatar-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid rgba(0, 255, 255, 0.6);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }
        
        .avatar-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .time-display {
            font-size: 11px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 12px;
            font-weight: 500;
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }
        
        .icon-link {
            color: #00ffff;
            text-decoration: none;
            display: flex;
            align-items: center;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            padding: 6px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .icon-link:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }
        
        .icon-link i {
            font-size: 18px;
        }
        
        .img-area {
            height: 130px;
            border-radius: 15px;
            overflow: hidden;
            margin: 12px 0;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(0, 255, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.2);
        }
        
        .img-area img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease;
        }
        
        .img-area .placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
            color: #00ffff;
            font-size: 14px;
            text-align: center;
            padding: 10px;
            z-index: 2;
        }
        
        .img-area .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00ffff;
            animation: spin 1s ease-in-out infinite;
            z-index: 1;
        }
        
        @keyframes spin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }
        
        .song-details {
            text-align: center;
            margin: 12px 0;
        }
        
        .song-details .name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 2px 10px rgba(0, 255, 255, 0.5);
            color: #ffffff;
        }
        
        .song-details .artist {
            font-size: 12px;
            opacity: 0.9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #00ffff;
            text-shadow: 0 1px 5px rgba(0, 255, 255, 0.3);
        }
        
        .progress-area {
            margin: 15px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4);
        }
        
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--progress, 0%);
            background: linear-gradient(90deg, #00ffff, #ff00ff, #ffff00);
            border-radius: 3px;
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
        }
        
        .song-timer {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            margin-top: 8px;
            opacity: 0.9;
            color: #00ffff;
            text-shadow: 0 1px 3px rgba(0, 255, 255, 0.3);
        }
        
        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 18px 0;
        }
        
        .controls i {
            font-size: 20px;
            color: #00ffff;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            text-shadow: 0 2px 8px rgba(0, 255, 255, 0.4);
        }
        
        .controls i:hover {
            background: rgba(0, 255, 255, 0.15);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .play-pause {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .play-pause:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 255, 255, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }
        
        .play-pause i {
            color: white;
            font-size: 22px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        .music-list-container {
            max-height: 180px;
            overflow-y: auto;
            margin-top: 12px;
        }
        
        .genre-list,
        .music-list {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 12px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .header .row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header span {
            font-size: 14px;
            font-weight: 600;
            color: #00ffff;
            text-shadow: 0 1px 5px rgba(0, 255, 255, 0.3);
        }
        
        .header i {
            cursor: pointer;
            font-size: 18px;
            color: #00ffff;
            text-shadow: 0 1px 5px rgba(0, 255, 255, 0.3);
        }
        
        ul {
            list-style: none;
        }
        
        li {
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            border: 1px solid rgba(0, 255, 255, 0.1);
            color: #ffffff;
        }
        
        li:hover {
            background: rgba(0, 255, 255, 0.15);
            transform: translateX(5px);
            border-color: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }
        
        .footer {
            text-align: center;
            font-size: 11px;
            opacity: 0.9;
            padding: 15px 8px;
            margin-top: 20px;
            width: 100%;
            color: #00ffff;
            text-shadow: 0 1px 5px rgba(0, 255, 255, 0.3);
        }
        
        .footer a {
            color: #ffff00;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .footer a:hover {
            color: #ff00ff;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
        }
        /* Scrollbar styling */
        
         ::-webkit-scrollbar {
            width: 4px;
        }
        
         ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }
        
         ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            border-radius: 2px;
        }
        
         ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ffff00, #ff00ff);
        }
        /* Auto scroll to selected song */
        
        .music-item.active {
            background: rgba(0, 255, 255, 0.2);
            border-left: 3px solid #00ffff;
            border-color: rgba(0, 255, 255, 0.6);
        }
        /* Ultra compact for very small devices */
        
        @media (max-width: 320px) {
            .wrapper {
                width: 98%;
                padding: 12px;
                max-width: 280px;
            }
            .img-area {
                height: 110px;
            }
            .song-details .name {
                font-size: 15px;
            }
            .controls {
                gap: 6px;
            }
            .controls i {
                font-size: 18px;
                padding: 6px;
            }
            .play-pause {
                width: 40px;
                height: 40px;
            }
            .play-pause i {
                font-size: 20px;
            }
            .music-list-container {
                max-height: 160px;
            }
        }
        
        .audio-loading {
            position: relative;
        }
        
        .audio-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00ffff;
            animation: spin 1s linear infinite;
        }
    </style>
</head>

<body>
    <div id="meteor-container"></div>

    <div class="wrapper">
        <div class="top-bar">
            <div class="avatar-icon">
                <img src="./images/avt2.jpg" alt="Avatar" loading="lazy">
            </div>
            <span id="vietnam-time" class="time-display">00:00:00</span>
            <a href="https://t.me/ItsMeemo123" target="_blank" id="telegram-link" class="icon-link">
                <i class="material-icons" title="Li√™n h·ªá Telegram">send</i>
            </a>
        </div>

        <div class="img-area">
            <div class="placeholder">ƒêang t·∫£i h√¨nh ·∫£nh...</div>
            <div class="loading-spinner" style="display: none;"></div>
            <img src="" alt="Music Card Image" id="main-image" style="opacity: 0;">
        </div>

        <div class="song-details">
            <p class="name">ƒêang t·∫£i b√†i h√°t...</p>
            <p class="artist">Vui l√≤ng ch·ªù</p>
        </div>

        <div class="progress-area">
            <div class="progress-bar">
                <audio id="main-audio" src="" preload="metadata"></audio>
            </div>
            <div class="song-timer">
                <span class="current-time">0:00</span>
                <span class="max-duration">0:00</span>
            </div>
        </div>

        <div class="controls">
            <i id="repeat-plist" class="material-icons" title="Playlist looped">repeat</i>
            <i id="prev" class="material-icons">skip_previous</i>
            <div class="play-pause" id="play-pause-btn">
                <i class="material-icons play">play_arrow</i>
            </div>
            <i id="next" class="material-icons">skip_next</i>
            <i id="more-music" class="material-icons">queue_music</i>
        </div>

        <div class="music-list-container">
            <div class="genre-list" id="genre-list" style="display: none;">
                <div class="header">
                    <div class="row">
                        <i class="list material-icons">queue_music</i>
                        <span>Th·ªÉ Lo·∫°i Nh·∫°c</span>
                    </div>
                    <i id="close-genre" class="material-icons">close</i>
                </div>
                <ul id="genre-ul">
                    <!-- Genre items will be populated by JavaScript -->
                </ul>
            </div>

            <div class="music-list" id="music-list" style="display: none;">
                <div class="header">
                    <div class="row">
                        <i id="back-to-genre" class="material-icons">arrow_back</i>
                        <span id="current-genre-name">Danh s√°ch nh·∫°c</span>
                    </div>
                    <i id="close-music-list" class="material-icons">close</i>
                </div>
                <ul id="music-ul">
                    <!-- Music items will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <footer class="footer">
        Designed by <a href="https://vukhuprofile.netlify.app/" target="_blank">VuKhu</a>
    </footer>

    <script>
        // Music data v·ªõi link ·∫£nh ƒë√£ ƒë∆∞·ª£c s·ª≠a - S·ª¨ D·ª§NG LINK GIPHY TH·ª∞C T·∫æ
        const allGenres = [{
            genre: "Vinahouse",
            songs: [{
                name: "LamSung SCL NST #1",
                artist: "Lamsung026",
                img: "https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExaHpzaDFmNXd6cjkxN2wxYjR0YWFxdGp3dmowNzltbjgzaWJsdDRpbSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/jh7F7XwHTywg85ekdl/giphy.gif",
                id: "music-2",
                src: "https://files.catbox.moe/9fy2ex.mp3",
            }, {
                name: "Ch√∫ H·ªÅ Ch∆°i ƒê·ªì",
                artist: "Chill",
                img: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3eGNkY2llaXdpb3ZvcDFwMDF3eHZuemtha3k0a3J2aGhlcXh0dWZ1dSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/c8P0srXm9BNug/giphy.gif",
                id: "music-3",
                src: "https://files.catbox.moe/gwxkal.mp3",
            }, {
                name: "LamSung SCL NST #2",
                artist: "Lamsung026",
                img: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3dHVta2JiZ3dteW13YmNxNmw2YmM0bXFpdDg2aWljemEweWc3cnB1YSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/5pRnyEv3ZxO0g/giphy.gif",
                id: "music-4",
                src: "https://files.catbox.moe/2a0dun.mp3",
            }, {
                name: "G√µ G√£y Ng∆∞·ªùi",
                artist: "CDAN",
                img: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3eThpNDg0bHNyYTJpMDJpMXU0N2VrN245OGZ3N2FqbTVvNGV5ZWNjbCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/aEGZ2AmirWIKa9QnqD/giphy.gif",
                id: "music-5",
                src: "https://files.catbox.moe/qml7rz.mp3",
            }]
        }, {
            genre: "Vietmix",
            songs: [{
                name: "Infinity Music Vol 6",
                artist: "Ferrari",
                img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExN2M5MTkwb3ExN3dtYnFraXdkMHk1eG50Ym5mbHY4enV2eWljNWdheSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/mG1uA7JnuAZqbWV44g/giphy.gif",
                id: "music-6",
                src: "https://files.catbox.moe/2a0dun.mp3",
            }]
        }, {
            genre: "Track L·∫ª",
            songs: [{
                name: "ƒê·ª´ng Ai Nh·∫Øc V·ªÅ C√¥ ·∫§y",
                artist: "Future Mix",
                img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExN2M5MTkwb3ExN3dtYnFraXdkMHk1eG50Ym5mbHY4enV2eWljNWdheSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/mG1uA7JnuAZqbWV44g/giphy.gif",
                id: "music-7",
                src: "https://files.catbox.moe/xyx091.mp3",
            }, {
                name: "Full Track",
                artist: "MACOL",
                img: "https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExdDc1dGswejIzdHRneW0xdjhnamVwZDhmMzZuOXViN3I5YzZ5cGhscyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/0iksAXjBPkaM96HpCZ/giphy.gif",
                id: "music-13",
                src: "https://files.catbox.moe/xyx091.mp3",
            }]
        }, {
            genre: "Nonstop",
            songs: [{
                name: "V·∫Ω C·∫£nh",
                artist: "VanhJB",
                img: "https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExeGkwNWJmanExdmxyNXk5MTJmcmlzcW95NGQyd2s2aWQzZWoyNWZvMiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/XcX3Ae8GSDWN1ciqqi/giphy.gif",
                id: "music-8",
                src: "https://files.catbox.moe/n9d4rv.mp3",
            }, {
                name: "Bay Kem Mix",
                artist: "VanhJB",
                img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExN2M5MTkwb3ExN3dtYnFraXdkMHk1eG50Ym5mbHY4enV2eWljNWdheSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/mG1uA7JnuAZqbWV44g/giphy.gif",
                id: "music-9",
                src: "https://files.catbox.moe/nc8fbe.mp3",
            }, {
                name: "2h Ketamin",
                artist: "Mix",
                img: "https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzZndHE4ejlvOTAwYjgyOXZ0aGV2dnd4bHRqcWRsa3prMnZrNWV0ZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/bv11Ek400Jqh0CJevj/giphy.gif",
                id: "music-10",
                src: "https://files.catbox.moe/uru2ru.mp3",
            }]
        }];

        // T·ªëi ∆∞u h√≥a t·∫£i GIF v·ªõi c√°c k·ªπ thu·∫≠t m·ªõi
        const imageCache = new Map();
        const audioCache = new Map(); // Cache cho audio
        const preloadQueue = [];
        let isPreloading = false;

        // Audio player functionality
        const mainAudio = document.getElementById('main-audio');
        const playPauseBtn = document.querySelector('.play-pause i');
        const playPauseContainer = document.getElementById('play-pause-btn');
        const progressBar = document.querySelector('.progress-bar');
        const currentTimeEl = document.querySelector('.current-time');
        const maxDurationEl = document.querySelector('.max-duration');
        const mainImage = document.getElementById('main-image');
        let isPlaying = false;
        let currentSongIndex = 0;
        let currentSongs = [];
        let isAudioLoading = false;

        // Meteor Showers Effect
        function createMeteor() {
            const container = document.getElementById('meteor-container');
            const meteor = document.createElement('div');
            meteor.className = Math.random() > 0.7 ? 'shooting-star' : 'meteor';

            const startX = Math.random() * 100;
            const startY = Math.random() * 50;

            meteor.style.left = startX + 'vw';
            meteor.style.top = startY + 'vh';
            meteor.style.animationDuration = (Math.random() * 3 + 2) + 's';

            container.appendChild(meteor);

            setTimeout(() => {
                if (meteor.parentNode) {
                    meteor.parentNode.removeChild(meteor);
                }
            }, 5000);
        }

        function createStars() {
            const container = document.getElementById('meteor-container');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                star.style.width = (Math.random() * 2 + 1) + 'px';
                star.style.height = star.style.width;
                star.style.animationDuration = (Math.random() * 3 + 1) + 's';
                star.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(star);
            }
        }

        function initMeteorShowers() {
            createStars();
            setInterval(createMeteor, 800);
            setInterval(createMeteor, 1200);
        }

        // Function to get random song from all genres
        function getRandomSong() {
            const allSongs = allGenres.flatMap(genre => genre.songs);
            const randomIndex = Math.floor(Math.random() * allSongs.length);
            const randomSong = allSongs[randomIndex];

            let genreIndex = -1;
            let songIndex = -1;

            for (let i = 0; i < allGenres.length; i++) {
                const genre = allGenres[i];
                const index = genre.songs.findIndex(song => song.id === randomSong.id);
                if (index !== -1) {
                    genreIndex = i;
                    songIndex = index;
                    break;
                }
            }

            return {
                song: randomSong,
                genreIndex: genreIndex,
                songIndex: songIndex,
                songs: allGenres[genreIndex].songs
            };
        }

        // T·ªëi ∆∞u h√≥a t·∫£i ·∫£nh v·ªõi queue v√† priority
        function addToPreloadQueue(imgUrl, priority = false) {
            if (imageCache.has(imgUrl)) return;

            const item = {
                imgUrl,
                priority
            };
            if (priority) {
                preloadQueue.unshift(item);
            } else {
                preloadQueue.push(item);
            }

            if (!isPreloading) {
                processPreloadQueue();
            }
        }

        async function processPreloadQueue() {
            if (isPreloading || preloadQueue.length === 0) return;

            isPreloading = true;

            while (preloadQueue.length > 0) {
                const {
                    imgUrl
                } = preloadQueue.shift();
                await loadImageWithCache(imgUrl);

                // Ngh·ªâ ng·∫Øn gi·ªØa c√°c l·∫ßn t·∫£i ƒë·ªÉ tr√°nh block UI
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            isPreloading = false;
        }

        // T·∫£i ·∫£nh v·ªõi cache v√† fallback - ƒê√É S·ª¨A L·ªñI
        async function loadImageWithCache(imgUrl) {
            if (imageCache.has(imgUrl)) {
                return imageCache.get(imgUrl);
            }

            return new Promise((resolve) => {
                const img = new Image();

                // Thi·∫øt l·∫≠p timeout ƒë·ªÉ tr√°nh treo
                const timeoutId = setTimeout(() => {
                    console.warn('Timeout loading image:', imgUrl);
                    img.onload = null;
                    img.onerror = null;
                    resolve(null);
                }, 5000); // Gi·∫£m timeout xu·ªëng 5 gi√¢y

                img.onload = () => {
                    clearTimeout(timeoutId);
                    imageCache.set(imgUrl, img);
                    console.log('‚úÖ ƒê√£ t·∫£i ·∫£nh th√†nh c√¥ng:', imgUrl);
                    resolve(img);
                };

                img.onerror = () => {
                    clearTimeout(timeoutId);
                    console.warn('‚ùå Kh√¥ng th·ªÉ t·∫£i ·∫£nh:', imgUrl);
                    imageCache.set(imgUrl, null);
                    resolve(null);
                };

                img.src = imgUrl;
            });
        }

        // T·∫£i audio v·ªõi cache v√† timeout
        async function loadAudioWithCache(audioUrl) {
            if (audioCache.has(audioUrl)) {
                return audioCache.get(audioUrl);
            }

            return new Promise((resolve) => {
                const audio = new Audio();

                // Thi·∫øt l·∫≠p timeout cho audio
                const timeoutId = setTimeout(() => {
                    console.warn('Timeout loading audio:', audioUrl);
                    audio.oncanplaythrough = null;
                    audio.onerror = null;
                    resolve(null);
                }, 10000); // 10 gi√¢y cho audio

                audio.oncanplaythrough = () => {
                    clearTimeout(timeoutId);
                    console.log('‚úÖ Audio ready to play:', audioUrl);
                    audioCache.set(audioUrl, audio);
                    resolve(audio);
                };

                audio.onerror = () => {
                    clearTimeout(timeoutId);
                    console.warn('‚ùå Kh√¥ng th·ªÉ t·∫£i audio:', audioUrl);
                    resolve(null);
                };

                // Preload metadata ƒë·ªÉ t·∫£i nhanh h∆°n
                audio.preload = 'metadata';
                audio.src = audioUrl;
            });
        }

        // H√†m l·∫•y ·∫£nh fallback khi ·∫£nh ch√≠nh l·ªói
        function getFallbackImage() {
            const fallbackImages = [
                "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExN2M5MTkwb3ExN3dtYnFraXdkMHk1eG50Ym5mbHY4enV2eWljNWdheSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/mG1uA7JnuAZqbWV44g/giphy.gif",
                "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb3B2bGJ6c2h3dW5mZ2V1Z2R0cXZ3Z2N6eGZ0eGZ0eGZ0eGZ0eGZlcD12MV9naWZzX3NlYXJjaCZjdD1n/l0MYt5jPR6QX5pnqM/giphy.gif",
                "https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExdDc1dGswejIzdHRneW0xdjhnamVwZDhmMzZuOXViN3I5YzZ5cGhscyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/0iksAXjBPkaM96HpCZ/giphy.gif"
            ];
            return fallbackImages[Math.floor(Math.random() * fallbackImages.length)];
        }

        // C·∫≠p nh·∫≠t ·∫£nh v·ªõi hi·ªáu ·ª©ng m∆∞·ª£t m√† v√† loading spinner - ƒê√É S·ª¨A L·ªñI
        async function updateImage(imgUrl) {
            const placeholder = document.querySelector('.img-area .placeholder');
            const spinner = document.querySelector('.img-area .loading-spinner');

            // Hi·ªÉn th·ªã placeholder v√† spinner
            placeholder.style.display = 'flex';
            spinner.style.display = 'block';
            mainImage.style.opacity = '0';

            try {
                // ∆Øu ti√™n t·∫£i ·∫£nh n√†y tr∆∞·ªõc
                addToPreloadQueue(imgUrl, true);
                const img = await loadImageWithCache(imgUrl);

                if (img && img.complete) {
                    mainImage.src = imgUrl;
                    showImage();
                } else {
                    // N·∫øu ·∫£nh ch√≠nh l·ªói, th·ª≠ ·∫£nh fallback
                    const fallbackUrl = getFallbackImage();
                    console.log('üîÑ S·ª≠ d·ª•ng ·∫£nh fallback:', fallbackUrl);
                    const fallbackImg = await loadImageWithCache(fallbackUrl);

                    if (fallbackImg && fallbackImg.complete) {
                        mainImage.src = fallbackUrl;
                        showImage();
                    } else {
                        showError();
                    }
                }
            } catch (error) {
                console.error('L·ªói khi t·∫£i ·∫£nh:', error);
                showError();
            }

            function showImage() {
                spinner.style.display = 'none';
                setTimeout(() => {
                    mainImage.style.opacity = '1';
                    placeholder.style.display = 'none';
                }, 100);
            }

            function showError() {
                spinner.style.display = 'none';
                placeholder.textContent = 'Kh√¥ng th·ªÉ t·∫£i ·∫£nh';
                placeholder.style.display = 'flex';
                // V·∫´n hi·ªÉn th·ªã ·∫£nh fallback d√π c√≥ l·ªói
                mainImage.src = getFallbackImage();
                mainImage.style.opacity = '1';
            }
        }

        // Hi·ªÉn th·ªã tr·∫°ng th√°i loading audio
        function showAudioLoading() {
            isAudioLoading = true;
            playPauseContainer.classList.add('audio-loading');
            playPauseBtn.style.opacity = '0.5';
        }

        // ·∫®n tr·∫°ng th√°i loading audio
        function hideAudioLoading() {
            isAudioLoading = false;
            playPauseContainer.classList.remove('audio-loading');
            playPauseBtn.style.opacity = '1';
        }

        // T·∫£i v√† ph√°t nh·∫°c v·ªõi t·ªëi ∆∞u h√≥a
        async function loadAndPlayAudio(audioUrl) {
            if (isAudioLoading) return;

            showAudioLoading();

            try {
                // D·ª´ng audio hi·ªán t·∫°i tr∆∞·ªõc
                mainAudio.pause();
                mainAudio.currentTime = 0;

                // Th·ª≠ s·ª≠ d·ª•ng audio cache tr∆∞·ªõc
                let audioToPlay = audioCache.get(audioUrl);

                if (!audioToPlay) {
                    console.log('üîÑ ƒêang t·∫£i audio...');
                    audioToPlay = await loadAudioWithCache(audioUrl);
                }

                if (audioToPlay) {
                    // S·ª≠ d·ª•ng audio ƒë√£ cache
                    mainAudio.src = audioUrl;

                    // ƒê·ª£i audio c√≥ th·ªÉ ph√°t ƒë∆∞·ª£c
                    await new Promise((resolve) => {
                        const onCanPlay = () => {
                            mainAudio.removeEventListener('canplay', onCanPlay);
                            resolve();
                        };
                        mainAudio.addEventListener('canplay', onCanPlay);
                    });

                    hideAudioLoading();

                    // T·ª± ƒë·ªông ph√°t sau khi t·∫£i xong
                    await mainAudio.play();
                    isPlaying = true;
                    playPauseBtn.textContent = 'pause';

                    console.log('‚úÖ Ph√°t nh·∫°c th√†nh c√¥ng');
                } else {
                    hideAudioLoading();
                    console.error('‚ùå Kh√¥ng th·ªÉ t·∫£i audio');
                    alert('Kh√¥ng th·ªÉ t·∫£i b√†i h√°t. Vui l√≤ng th·ª≠ l·∫°i sau.');
                }
            } catch (error) {
                hideAudioLoading();
                console.error('L·ªói khi ph√°t nh·∫°c:', error);
            }
        }

        // Preload t·∫•t c·∫£ ·∫£nh v·ªõi ƒë·ªô ∆∞u ti√™n th·∫•p
        function preloadAllImages() {
            allGenres.forEach(genre => {
                genre.songs.forEach(song => {
                    if (song.img) {
                        addToPreloadQueue(song.img, false);
                    }
                });
            });
        }

        // Preload audio cho b√†i h√°t ti·∫øp theo
        function preloadNextAudio() {
            if (currentSongs.length > 0) {
                const nextIndex = (currentSongIndex + 1) % currentSongs.length;
                const nextSong = currentSongs[nextIndex];
                if (nextSong && !audioCache.has(nextSong.src)) {
                    console.log('üîÆ Preloading next audio:', nextSong.name);
                    loadAudioWithCache(nextSong.src);
                }
            }
        }

        // Load random song immediately (kh√¥ng t·ª± ƒë·ªông play)
        function loadRandomSong() {
            const randomData = getRandomSong();
            if (randomData.song) {
                document.querySelector('.song-details .name').textContent = randomData.song.name;
                document.querySelector('.song-details .artist').textContent = randomData.song.artist;

                if (randomData.song.img) {
                    updateImage(randomData.song.img);
                }

                currentSongs = randomData.songs;
                currentSongIndex = randomData.songIndex;

                // Ch·ªâ load metadata, kh√¥ng ph√°t ngay
                mainAudio.src = randomData.song.src;
                mainAudio.load();

                console.log('ƒê√£ t·∫£i s·∫µn b√†i h√°t:', randomData.song.name);

                // Preload b√†i ti·∫øp theo
                preloadNextAudio();
            }
        }

        // Play/pause functionality
        async function togglePlayPause() {
            if (!mainAudio.src || isAudioLoading) return;

            if (isPlaying) {
                mainAudio.pause();
                playPauseBtn.textContent = 'play_arrow';
                isPlaying = false;
            } else {
                // N·∫øu audio ch∆∞a ƒë∆∞·ª£c t·∫£i ƒë·∫ßy ƒë·ªß, t·∫£i l·∫°i
                if (mainAudio.readyState < 3) {
                    await loadAndPlayAudio(mainAudio.src);
                } else {
                    try {
                        await mainAudio.play();
                        playPauseBtn.textContent = 'pause';
                        isPlaying = true;
                    } catch (error) {
                        console.log('Audio play failed:', error);
                        // Th·ª≠ t·∫£i l·∫°i n·∫øu ph√°t th·∫•t b·∫°i
                        await loadAndPlayAudio(mainAudio.src);
                    }
                }
            }
        }

        // Update progress bar
        function updateProgress() {
            if (!mainAudio.src) return;

            const {
                currentTime,
                duration
            } = mainAudio;
            const progressPercent = (currentTime / duration) * 100;
            progressBar.style.setProperty('--progress', `${progressPercent}%`);

            currentTimeEl.textContent = formatTime(currentTime);
            maxDurationEl.textContent = formatTime(duration);
        }

        // Format time to mm:ss
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec.toString().padStart(2, '0')}`;
        }

        // Seek functionality
        function seek(e) {
            if (!mainAudio.src || isAudioLoading) return;

            const progressWidth = progressBar.clientWidth;
            const clickedOffsetX = e.offsetX;
            const songDuration = mainAudio.duration;

            mainAudio.currentTime = (clickedOffsetX / progressWidth) * songDuration;
        }

        // Event listeners for audio controls
        document.querySelector('.play-pause').addEventListener('click', togglePlayPause);
        progressBar.addEventListener('click', seek);
        mainAudio.addEventListener('timeupdate', updateProgress);
        mainAudio.addEventListener('loadedmetadata', updateProgress);

        // Music list management v·ªõi data th·ª±c t·∫ø
        function initMusicList() {
            const genreList = document.getElementById('genre-list');
            const musicList = document.getElementById('music-list');
            const backToGenre = document.getElementById('back-to-genre');
            const closeGenre = document.getElementById('close-genre');
            const closeMusicList = document.getElementById('close-music-list');
            const moreMusic = document.getElementById('more-music');

            // Populate genre list t·ª´ allGenres
            const genreUl = document.getElementById('genre-ul');
            allGenres.forEach(genreData => {
                const li = document.createElement('li');
                li.textContent = genreData.genre;
                li.onclick = () => {
                    showMusicList(genreData.genre, genreData.songs);
                };
                genreUl.appendChild(li);
            });

            // Show music list function
            function showMusicList(genreName, songs) {
                genreList.style.display = 'none';
                musicList.style.display = 'block';
                document.getElementById('current-genre-name').textContent = genreName;

                const musicUl = document.getElementById('music-ul');
                musicUl.innerHTML = '';

                songs.forEach((song, index) => {
                    const li = document.createElement('li');
                    li.className = 'music-item';
                    li.innerHTML = `
                        <strong>${song.name}</strong><br>
                        <small>${song.artist}</small>
                    `;
                    li.onclick = () => {
                        document.querySelectorAll('.music-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        li.classList.add('active');
                        playSelectedSong(song, songs, index);
                        setTimeout(() => {
                            musicList.style.display = 'none';
                        }, 300);
                    };
                    musicUl.appendChild(li);
                });
            }

            // Back to genre list
            backToGenre.onclick = () => {
                musicList.style.display = 'none';
                genreList.style.display = 'block';
            };

            // Close buttons
            closeGenre.onclick = () => {
                genreList.style.display = 'none';
            };

            closeMusicList.onclick = () => {
                musicList.style.display = 'none';
            };

            // More music button - Toggle genre list
            moreMusic.onclick = () => {
                if (genreList.style.display === 'none') {
                    genreList.style.display = 'block';
                    musicList.style.display = 'none';
                } else {
                    genreList.style.display = 'none';
                }
            };

            // Play selected song function
            async function playSelectedSong(song, songs, index) {
                document.querySelector('.song-details .name').textContent = song.name;
                document.querySelector('.song-details .artist').textContent = song.artist;

                if (song.img) {
                    updateImage(song.img);
                }

                currentSongs = songs;
                currentSongIndex = index;

                // S·ª≠ d·ª•ng h√†m t·ªëi ∆∞u ƒë·ªÉ t·∫£i v√† ph√°t nh·∫°c
                await loadAndPlayAudio(song.src);

                // Preload b√†i ti·∫øp theo
                preloadNextAudio();
            }

            // Next/previous functionality
            document.getElementById('next').addEventListener('click', async() => {
                if (currentSongs.length > 0 && !isAudioLoading) {
                    currentSongIndex = (currentSongIndex + 1) % currentSongs.length;
                    const nextSong = currentSongs[currentSongIndex];
                    await playSelectedSong(nextSong, currentSongs, currentSongIndex);
                }
            });

            document.getElementById('prev').addEventListener('click', async() => {
                if (currentSongs.length > 0 && !isAudioLoading) {
                    currentSongIndex = (currentSongIndex - 1 + currentSongs.length) % currentSongs.length;
                    const prevSong = currentSongs[currentSongIndex];
                    await playSelectedSong(prevSong, currentSongs, currentSongIndex);
                }
            });

            // Repeat functionality
            let repeatMode = 0;
            document.getElementById('repeat-plist').addEventListener('click', () => {
                repeatMode = (repeatMode + 1) % 3;
                const repeatBtn = document.getElementById('repeat-plist');

                switch (repeatMode) {
                    case 0:
                        repeatBtn.textContent = 'repeat';
                        repeatBtn.title = 'Repeat off';
                        break;
                    case 1:
                        repeatBtn.textContent = 'repeat';
                        repeatBtn.style.color = '#00ffff';
                        repeatBtn.title = 'Repeat all';
                        break;
                    case 2:
                        repeatBtn.textContent = 'repeat_one';
                        repeatBtn.title = 'Repeat one';
                        break;
                }
            });

            // Auto play next song when current ends
            mainAudio.addEventListener('ended', async() => {
                if (repeatMode === 2) {
                    mainAudio.currentTime = 0;
                    await mainAudio.play();
                } else if (currentSongs.length > 0) {
                    if (repeatMode === 1 || currentSongIndex < currentSongs.length - 1) {
                        currentSongIndex = (currentSongIndex + 1) % currentSongs.length;
                        const nextSong = currentSongs[currentSongIndex];
                        await playSelectedSong(nextSong, currentSongs, currentSongIndex);
                    } else {
                        isPlaying = false;
                        playPauseBtn.textContent = 'play_arrow';
                    }
                }
            });
        }

        // Vietnam time display
        function updateVietnamTime() {
            const now = new Date();
            const options = {
                timeZone: 'Asia/Ho_Chi_Minh',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const timeString = now.toLocaleTimeString('vi-VN', options);
            document.getElementById('vietnam-time').textContent = timeString;
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Kh·ªüi t·∫°o hi·ªáu ·ª©ng Meteor Showers
            initMeteorShowers();

            // Preload t·∫•t c·∫£ ·∫£nh khi trang t·∫£i
            preloadAllImages();

            // T·∫£i b√†i h√°t random
            loadRandomSong();

            // Enable effects after user interaction
            function enableAfterInteraction() {
                initMusicList();
                setInterval(updateVietnamTime, 1000);
                updateVietnamTime();

                window.removeEventListener('click', enableAfterInteraction);
                window.removeEventListener('keydown', enableAfterInteraction);
            }

            window.addEventListener('click', enableAfterInteraction, {
                once: true
            });
            window.addEventListener('keydown', enableAfterInteraction, {
                once: true
            });
        });
    </script>
</body>

</html>
